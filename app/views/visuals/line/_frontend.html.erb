
<% visual.datasets.each do |dataset| %>
  <canvas id="dataset_<%= dataset.query_id %>"></canvas>
  <script>
    const ctx_<%= dataset.query_id %> = document.getElementById('dataset_<%= dataset.query_id %>').getContext('2d');
    const chart_<%= dataset.query_id %> = new Chart(ctx_<%= dataset.query_id %>, {
      type: 'line',
      data: {
          labels: <%= dataset.data.rows.transpose.first.to_json.html_safe %>,
          datasets: [
            <%= dataset.data.rows.transpose[1..-1].each_with_index.map do |ds, idx|
              {
                label: dataset.data.columns[idx + 1],
                data: ds,
                fill: false
              }.to_json
            end.join(",\n").html_safe %>
          ]
      },
      options: {
          scales: {
              y: {
                  beginAtZero: true
              }
          }
      }
  });
  </script>
<% end %>
