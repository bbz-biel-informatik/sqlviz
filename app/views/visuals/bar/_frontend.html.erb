<% visual.datasets.each do |dataset| %>
  <div class="ct-chart ct-golden-section" id="dataset_<%= dataset.query_id %>"></div>
  <% dataset.fields[1..-1].each_with_index do |field, idx| %>
    <%= legend(field, idx).html_safe %>
  <% end %>
  <script>
    new Chartist.Bar('#dataset_<%= dataset.query_id %>', {
      labels: <%= dataset.values.transpose.first.to_json.html_safe %>,
      series: <%= dataset.values.transpose[1..-1].to_json.html_safe %>
    }, {
      axisX: {
        labelInterpolationFnc: function (value, index) {
          return index % <%= dataset.values.count / 8 %> == 0 ? value: null;
        }
      }
    });
  </script>
<% end %>
